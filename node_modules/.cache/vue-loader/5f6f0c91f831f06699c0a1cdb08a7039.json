{"remainingRequest":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Login.vue?vue&type=template&id=15717af5&scoped=true","dependencies":[{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Login.vue","mtime":1658979157304},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\babel-loader\\lib\\index.js","mtime":1658554870645},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1658554972315},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1658554910597}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQogIDxOYXYgLz4NCiAgPHZhbi1mb3JtIHJlZj0iZm9ybUJveCIgQHN1Ym1pdD0ic3VibWl0Ij4NCiAgICA8dmFuLWNlbGwtZ3JvdXAgaW5zZXQ+DQogICAgICA8IS0tIOaJi+acuuWPtyAtLT4NCiAgICAgIDx2YW4tZmllbGQNCiAgICAgICAgdi1tb2RlbD0icGhvbmUiDQogICAgICAgIGNlbnRlcg0KICAgICAgICBsYWJlbD0i5omL5py65Y+3Ig0KICAgICAgICBsYWJlbC13aWR0aD0iNTBweCINCiAgICAgICAgbmFtZT0icGhvbmUiDQogICAgICAgIDpydWxlcz0iWw0KICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfmiYvmnLrlj7fkuLrlv4XloavpobknIH0sDQogICAgICAgICAgeyBwYXR0ZXJuOiByZWdQaG9uZSwgbWVzc2FnZTogJ+aJi+acuuWPt+agvOW8j+S4jeWvueWTpn4nIH0sDQogICAgICAgIF0iDQogICAgICA+DQogICAgICAgIDx0ZW1wbGF0ZSAjYnV0dG9uPg0KICAgICAgICAgIDx2YW4tYnV0dG9uDQogICAgICAgICAgICBzaXplPSJzbWFsbCINCiAgICAgICAgICAgIDp0eXBlPSJlbmFibGUgPyAncHJpbWFyeScgOiAnJyINCiAgICAgICAgICAgIEBjbGljaz0ic2VuZGNvZGUiDQogICAgICAgICAgICBjbGFzcz0iZm9ybS1idG4iDQogICAgICAgICAgICA6ZGlzYWJsZWQ9IiFlbmFibGUiDQogICAgICAgICAgPg0KICAgICAgICAgICAge3sgZW5hYmxlID8gIuWPkemAgemqjOivgeeggSIgOiB0aW1lIH19DQogICAgICAgICAgPC92YW4tYnV0dG9uPg0KICAgICAgICA8L3RlbXBsYXRlPg0KICAgICAgPC92YW4tZmllbGQ+DQogICAgICA8IS0tIOmqjOivgeeggSAtLT4NCiAgICAgIDx2YW4tZmllbGQNCiAgICAgICAgdi1tb2RlbD0iY29kZSINCiAgICAgICAgbGFiZWw9IumqjOivgeeggSINCiAgICAgICAgbGFiZWwtd2lkdGg9IjUwcHgiDQogICAgICAgIDpydWxlcz0iWw0KICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfpqozor4HnoIHkuLrlv4XloavpobknIH0sDQogICAgICAgICAgeyBwYXR0ZXJuOiByZWdDb2RlLCBtZXNzYWdlOiAn6aqM6K+B56CB5b+F6aG75piv5YWt5L2N5pWw5a2X5ZOmJyB9LA0KICAgICAgICBdIg0KICAgICAgLz4NCiAgICA8L3Zhbi1jZWxsLWdyb3VwPg0KDQogICAgPCEtLSDnmbvlvZUv5rOo5YaM5oyJ6ZKuIC0tPg0KICAgIDxkaXYgc3R5bGU9Im1hcmdpbjogMjBweCA0MHB4Ij4NCiAgICAgIDx2YW4tYnV0dG9uIHJvdW5kIGJsb2NrIHR5cGU9InByaW1hcnkiIG5hdGl2ZS10eXBlPSJzdWJtaXQiPg0KICAgICAgICDnq4vljbPnmbvlvZUv5rOo5YaMDQogICAgICA8L3Zhbi1idXR0b24+DQogICAgPC9kaXY+DQogIDwvdmFuLWZvcm0+DQo="},{"version":3,"sources":["C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Login.vue"],"names":[],"mappings":"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","file":"C:/Users/James/Desktop/kejian/vue3知乎日报/zhihu/src/pages/Login.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <Nav />\r\n  <van-form ref=\"formBox\" @submit=\"submit\">\r\n    <van-cell-group inset>\r\n      <!-- 手机号 -->\r\n      <van-field\r\n        v-model=\"phone\"\r\n        center\r\n        label=\"手机号\"\r\n        label-width=\"50px\"\r\n        name=\"phone\"\r\n        :rules=\"[\r\n          { required: true, message: '手机号为必填项' },\r\n          { pattern: regPhone, message: '手机号格式不对哦~' },\r\n        ]\"\r\n      >\r\n        <template #button>\r\n          <van-button\r\n            size=\"small\"\r\n            :type=\"enable ? 'primary' : ''\"\r\n            @click=\"sendcode\"\r\n            class=\"form-btn\"\r\n            :disabled=\"!enable\"\r\n          >\r\n            {{ enable ? \"发送验证码\" : time }}\r\n          </van-button>\r\n        </template>\r\n      </van-field>\r\n      <!-- 验证码 -->\r\n      <van-field\r\n        v-model=\"code\"\r\n        label=\"验证码\"\r\n        label-width=\"50px\"\r\n        :rules=\"[\r\n          { required: true, message: '验证码为必填项' },\r\n          { pattern: regCode, message: '验证码必须是六位数字哦' },\r\n        ]\"\r\n      />\r\n    </van-cell-group>\r\n\r\n    <!-- 登录/注册按钮 -->\r\n    <div style=\"margin: 20px 40px\">\r\n      <van-button round block type=\"primary\" native-type=\"submit\">\r\n        立即登录/注册\r\n      </van-button>\r\n    </div>\r\n  </van-form>\r\n</template>\r\n\r\n<script>\r\nimport Nav from \"@/components/Nav.vue\";\r\nimport { reactive, toRefs, ref } from \"vue\";\r\nimport api from \"../api/index\";\r\nimport { Toast } from \"vant\";\r\nimport { useStore} from 'vuex';\r\nimport{useRouter, useRoute} from 'vue-router'\r\nexport default {\r\n  components: { Nav },\r\n  name: \"Login\",\r\n  setup() {\r\n    const store = useStore(),\r\n     router = useRouter(),\r\n     route = useRoute();\r\n\r\n    let state = reactive({\r\n      phone: \"\",\r\n      code: \"\",\r\n      enable: true,\r\n      time: \"60s\",\r\n    });\r\n    let formBox = ref(null);\r\n    // 发送验证码\r\n    const sendcode = async () => {\r\n      try {\r\n        // 校验手机号\r\n        await formBox.value.validate(\"phone\");\r\n        // 发送请求\r\n        let { code } = await api.phoneCode(state.phone);\r\n        if (+code !== 0) {\r\n          Toast(\"当前网络繁忙，请稍后再试！\");\r\n          return;\r\n        }\r\n        // 开启倒计时\r\n        state.enable = false;\r\n        state.time = `10s`;\r\n        let n = 10;\r\n        let timer = setInterval(() => {\r\n          n--;\r\n          if (n === 0) {\r\n            clearInterval(timer);\r\n            state.enable = true;\r\n            return;\r\n          }\r\n          state.time = `${n}s`;\r\n        }, 1000);\r\n      } catch (error) {}\r\n    };\r\n    // 表单提交\r\n    const submit = async () => {\r\n      // 登录\r\n      let { code, token } = await api.login(state.phone, state.code);\r\n      // 通过code，验证是否登录成功\r\n      if(+code !== 0) {\r\n        Toast('小主很遗憾，当前登录失败了!');\r\n        formBox.value.resetValidation();\r\n        state.code = '';\r\n        return;\r\n      }\r\n      // 存储token信息\r\n      localStorage.setItem('token', token);\r\n      // 存储是否登录的状态\r\n      store.commit('changeIsLogin', true);\r\n      // 存储获取到的登录的信息\r\n      store.dispatch('changeAsyncInfo')\r\n      // 清除vuex中已有的storelist的信息\r\n      store.commit('changeStoreList', null);\r\n      Toast('小主真棒，当前登录成功了!');\r\n      let from = route.query.from;\r\n      // route中如果有from跳转到from，没有from跳转到个人中心\r\n      if(from) {\r\n        router.replace(`/${from}`);\r\n        return;\r\n      }\r\n      router.replace(`/person`);\r\n    };\r\n\r\n    return {\r\n      ...toRefs(state),\r\n      formBox,\r\n      regPhone: /^1\\d{10}/,\r\n      regCode: /\\d{6}/,\r\n      sendcode,\r\n      submit,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.van-form {\r\n  margin-top: 30px;\r\n\r\n  .form-btn {\r\n    width: 78px;\r\n  }\r\n}\r\n</style>\r\n"]}]}