{"remainingRequest":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Detail.vue?vue&type=template&id=74779916&scoped=true","dependencies":[{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Detail.vue","mtime":1660475592847},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\babel-loader\\lib\\index.js","mtime":1658554870645},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1658554972315},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1658554910597}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQogIDx2YW4tc2tlbGV0b24gdGl0bGUgOnJvdz0iNSIgdi1pZj0ibmV3c0luZm8gPT09IG51bGwiIC8+DQogIDxkaXYgY2xhc3M9ImNvbnRlbnQiIHYtZWxzZSB2LWh0bWw9Im5ld3NJbmZvLmJvZHkiPjwvZGl2Pg0KDQogIDxkaXYgY2xhc3M9Im5hdi1ib3giPg0KICAgIDx2YW4taWNvbiBuYW1lPSJhcnJvdy1sZWZ0IiBAY2xpY2s9ImhhbmRsZSIgLz4NCiAgICA8dmFuLWljb24gbmFtZT0iY29tbWVudC1vIiA6YmFkZ2U9ImNvbW1lbnRzIiAvPg0KICAgIDx2YW4taWNvbiBuYW1lPSJnb29kLWpvYi1vIiA6YmFkZ2U9InBvcHVsYXJpdHkiIC8+DQogICAgPHZhbi1pY29uDQogICAgICBuYW1lPSJzdGFyLW8iDQogICAgICA6Y29sb3I9ImlzU3RvcmUgPyAnIzE5ODlmYScgOiAnIzAwMCciDQogICAgICBAY2xpY2s9InN0b3JlSGFuZGxlIg0KICAgIC8+DQogICAgPHZhbi1pY29uIG5hbWU9InNoYXJlLW8iIGNvbG9yPSIjY2NjIiAvPg0KICA8L2Rpdj4NCg=="},{"version":3,"sources":["C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Detail.vue"],"names":[],"mappings":";EACE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;EACvD,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;EAExD,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAClB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IAC7C,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IAC9C,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACjD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MACpC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACrB,CAAC;IACD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;EACzC,CAAC,CAAC,CAAC,CAAC,CAAC","file":"C:/Users/James/Desktop/kejian/vue3知乎日报/zhihu/src/pages/Detail.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <van-skeleton title :row=\"5\" v-if=\"newsInfo === null\" />\r\n  <div class=\"content\" v-else v-html=\"newsInfo.body\"></div>\r\n\r\n  <div class=\"nav-box\">\r\n    <van-icon name=\"arrow-left\" @click=\"handle\" />\r\n    <van-icon name=\"comment-o\" :badge=\"comments\" />\r\n    <van-icon name=\"good-job-o\" :badge=\"popularity\" />\r\n    <van-icon\r\n      name=\"star-o\"\r\n      :color=\"isStore ? '#1989fa' : '#000'\"\r\n      @click=\"storeHandle\"\r\n    />\r\n    <van-icon name=\"share-o\" color=\"#ccc\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport api from '@/api'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport {\r\n  reactive,\r\n  toRefs,\r\n  onBeforeMount,\r\n  onBeforeUnmount,\r\n  onUpdated,\r\n  computed\r\n} from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { Toast } from 'vant'\r\n\r\nexport default {\r\n  name: 'Detail',\r\n  setup() {\r\n    const router = new useRouter(),\r\n      route = useRoute(),\r\n      store = useStore()\r\n\r\n    let state = reactive({\r\n      comments: 0, //评论数\r\n      popularity: 0, //点赞数\r\n      newsInfo: null //新闻信息\r\n    })\r\n    let isLogin = computed(() => {\r\n      return store.state.isLogin\r\n    })\r\n    let storeList = computed(() => {\r\n      return store.state.storeList || []\r\n    })\r\n    let isStore = computed(() => {\r\n      let { isLogin, storeList } = store.state\r\n      if (isLogin) {\r\n        // 判断是否登录，并检查收藏列表中是否有该项\r\n        if (!Array.isArray(storeList)) storeList = []\r\n        return storeList.some(item => {\r\n          return +item.news.id === +route.params.id\r\n        })\r\n      }\r\n    })\r\n    const storeHandle = async () => {\r\n      // 是否登录\r\n      if (!store.state.isLogin) {\r\n        Toast('小主请先登录')\r\n        router.push({\r\n          path: '/login',\r\n          query: {\r\n            from: `detail/${route.params.id}`\r\n          }\r\n        })\r\n        return\r\n      }\r\n      // 如果已经收藏，则移除收藏 ？\r\n      if (isStore.value) return\r\n      /* 发送收藏请求 */\r\n      let { code } = await api.store(route.params.id)\r\n      if (+code !== 0) {\r\n        Toast('小主，很遗憾，收藏失败')\r\n        return\r\n      }\r\n      Toast('小主很棒，收藏成功了~')\r\n      // 更新vuex中的storeList的数据\r\n      store.dispatch('changeStoreListAsync')\r\n    }\r\n\r\n    onBeforeMount(async () => {\r\n      if (store.state.isLogin === null) {\r\n        await store.dispatch('changeAsyncIsLogin')\r\n      }\r\n      if (store.state.isLogin) {\r\n        if (store.state.info === null) store.dispatch('changeAsyncInfo')\r\n        if (store.state.storeList === null) {\r\n          store.dispatch('changeStoreListAsync')\r\n        }\r\n      }\r\n    })\r\n\r\n    onBeforeMount(async () => {\r\n      let id = route.params.id\r\n      let result = await api.queryNewsInfo(id) //获取的当前id的信息\r\n      // 页面的内容信息\r\n      state.newsInfo = result\r\n      // 动态创建css\r\n      let link = document.createElement('link')\r\n      link.id = 'link'\r\n      link.rel = 'stylesheet'\r\n      link.href = state.newsInfo.css[0]\r\n      document.head.appendChild(link)\r\n      let { popularity, comments } = await api.queryNewsStory(id)\r\n      state.comments = comments //评论数\r\n      state.popularity = popularity //点赞数\r\n    })\r\n\r\n    onUpdated(() => {\r\n      let imgPlaceHolder = document.querySelector('.img-place-holder')\r\n      if (imgPlaceHolder) {\r\n        if (imgPlaceHolder.innerHTML.trim() === '') {\r\n          imgPlaceHolder.innerHTML += `<img src=\"${state.newsInfo.image}\" />`\r\n          imgPlaceHolder.innerHTML += `<div class=\"mask\">\r\n            <h2 class=\"title\">\r\n              ${state.newsInfo.title}\r\n            </h2>\r\n          </div>`\r\n        }\r\n      }\r\n    })\r\n\r\n    onBeforeUnmount(() => {\r\n      // 移除css，防止与其他页面的样式发生冲突\r\n      let link = document.getElementById('link')\r\n      if (!link) return\r\n      document.head.removeChild(link)\r\n    })\r\n\r\n    const handle = function() {\r\n      router.back()\r\n    }\r\n    return {\r\n      handle,\r\n      ...toRefs(state),\r\n      isLogin,\r\n      storeList,\r\n      isStore,\r\n      storeHandle\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .van-skeleton {\r\n    padding: 30px 15px;\r\n  }\r\n\r\n  .content {\r\n    background-color: #fff;\r\n    padding-bottom: 50px;\r\n    margin-top: 0;\r\n    // 在scoped直接使用less,scss修改vant样式是无效的,需要添加deep来设置样式,即影响子元素\r\n    /deep/ .img-place-holder {\r\n      position: relative;\r\n      height: 375px;\r\n      overflow: hidden;\r\n\r\n      img {\r\n        display: block;\r\n        margin: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n\r\n      .mask {\r\n        position: absolute;\r\n        bottom: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 200px;\r\n        background: -webkit-linear-gradient(\r\n          bottom,\r\n          rgba(0, 0, 0, 0.3),\r\n          rgba(0, 0, 0, 0)\r\n        );\r\n\r\n        .title {\r\n          position: absolute;\r\n          bottom: 20px;\r\n          left: 10px;\r\n          padding: 0 20px;\r\n          font-size: 20px;\r\n          color: #fff;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .nav-box {\r\n    position: fixed;\r\n    left: 0;\r\n    bottom: 0;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    box-sizing: border-box;\r\n    padding: 0 15px;\r\n    width: 100%;\r\n    height: 50px;\r\n    background-color: #f4f4f4;\r\n\r\n    .van-icon:nth-child(1) {\r\n      position: relative;\r\n\r\n      &::after {\r\n        position: absolute;\r\n        top: -10%;\r\n        right: -15px;\r\n        content: '';\r\n        width: 1px;\r\n        height: 120%;\r\n        background: #d5d5d5;\r\n      }\r\n    }\r\n\r\n    /deep/ .van-badge {\r\n      background: transparent;\r\n      border: none;\r\n      color: #000;\r\n      right: -5px;\r\n    }\r\n  }\r\n</style>\r\n"]}]}