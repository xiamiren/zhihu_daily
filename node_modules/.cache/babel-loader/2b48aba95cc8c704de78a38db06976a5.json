{"remainingRequest":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Login.vue?vue&type=template&id=15717af5&scoped=true","dependencies":[{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Login.vue","mtime":1658979157304},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\babel.config.js","mtime":1658239012002},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\babel-loader\\lib\\index.js","mtime":1658554870645},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1658554972315},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1658554910597}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgcmVzb2x2ZUNvbXBvbmVudCBhcyBfcmVzb2x2ZUNvbXBvbmVudCwgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCBjcmVhdGVDb21tZW50Vk5vZGUgYXMgX2NyZWF0ZUNvbW1lbnRWTm9kZSwgdG9EaXNwbGF5U3RyaW5nIGFzIF90b0Rpc3BsYXlTdHJpbmcsIGNyZWF0ZVRleHRWTm9kZSBhcyBfY3JlYXRlVGV4dFZOb2RlLCB3aXRoQ3R4IGFzIF93aXRoQ3R4LCBjcmVhdGVFbGVtZW50Vk5vZGUgYXMgX2NyZWF0ZUVsZW1lbnRWTm9kZSwgRnJhZ21lbnQgYXMgX0ZyYWdtZW50LCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlRWxlbWVudEJsb2NrIGFzIF9jcmVhdGVFbGVtZW50QmxvY2ssIHB1c2hTY29wZUlkIGFzIF9wdXNoU2NvcGVJZCwgcG9wU2NvcGVJZCBhcyBfcG9wU2NvcGVJZCB9IGZyb20gInZ1ZSI7Cgp2YXIgX3dpdGhTY29wZUlkID0gZnVuY3Rpb24gX3dpdGhTY29wZUlkKG4pIHsKICByZXR1cm4gX3B1c2hTY29wZUlkKCJkYXRhLXYtMTU3MTdhZjUiKSwgbiA9IG4oKSwgX3BvcFNjb3BlSWQoKSwgbjsKfTsKCnZhciBfaG9pc3RlZF8xID0gewogIHN0eWxlOiB7CiAgICAibWFyZ2luIjogIjIwcHggNDBweCIKICB9Cn07Cgp2YXIgX2hvaXN0ZWRfMiA9IC8qI19fUFVSRV9fKi9fY3JlYXRlVGV4dFZOb2RlKCIg56uL5Y2z55m75b2VL+azqOWGjCAiKTsKCmV4cG9ydCBmdW5jdGlvbiByZW5kZXIoX2N0eCwgX2NhY2hlLCAkcHJvcHMsICRzZXR1cCwgJGRhdGEsICRvcHRpb25zKSB7CiAgdmFyIF9jb21wb25lbnRfTmF2ID0gX3Jlc29sdmVDb21wb25lbnQoIk5hdiIpOwoKICB2YXIgX2NvbXBvbmVudF92YW5fYnV0dG9uID0gX3Jlc29sdmVDb21wb25lbnQoInZhbi1idXR0b24iKTsKCiAgdmFyIF9jb21wb25lbnRfdmFuX2ZpZWxkID0gX3Jlc29sdmVDb21wb25lbnQoInZhbi1maWVsZCIpOwoKICB2YXIgX2NvbXBvbmVudF92YW5fY2VsbF9ncm91cCA9IF9yZXNvbHZlQ29tcG9uZW50KCJ2YW4tY2VsbC1ncm91cCIpOwoKICB2YXIgX2NvbXBvbmVudF92YW5fZm9ybSA9IF9yZXNvbHZlQ29tcG9uZW50KCJ2YW4tZm9ybSIpOwoKICByZXR1cm4gX29wZW5CbG9jaygpLCBfY3JlYXRlRWxlbWVudEJsb2NrKF9GcmFnbWVudCwgbnVsbCwgW19jcmVhdGVWTm9kZShfY29tcG9uZW50X05hdiksIF9jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9mb3JtLCB7CiAgICByZWY6ICJmb3JtQm94IiwKICAgIG9uU3VibWl0OiAkc2V0dXAuc3VibWl0CiAgfSwgewogICAgZGVmYXVsdDogX3dpdGhDdHgoZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW19jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9jZWxsX2dyb3VwLCB7CiAgICAgICAgaW5zZXQ6ICIiCiAgICAgIH0sIHsKICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gW19jcmVhdGVDb21tZW50Vk5vZGUoIiDmiYvmnLrlj7cgIiksIF9jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9maWVsZCwgewogICAgICAgICAgICBtb2RlbFZhbHVlOiBfY3R4LnBob25lLAogICAgICAgICAgICAib25VcGRhdGU6bW9kZWxWYWx1ZSI6IF9jYWNoZVswXSB8fCAoX2NhY2hlWzBdID0gZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgICAgIHJldHVybiBfY3R4LnBob25lID0gJGV2ZW50OwogICAgICAgICAgICB9KSwKICAgICAgICAgICAgY2VudGVyOiAiIiwKICAgICAgICAgICAgbGFiZWw6ICLmiYvmnLrlj7ciLAogICAgICAgICAgICAibGFiZWwtd2lkdGgiOiAiNTBweCIsCiAgICAgICAgICAgIG5hbWU6ICJwaG9uZSIsCiAgICAgICAgICAgIHJ1bGVzOiBbewogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmiYvmnLrlj7fkuLrlv4XloavpobknCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICBwYXR0ZXJuOiAkc2V0dXAucmVnUGhvbmUsCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+aJi+acuuWPt+agvOW8j+S4jeWvueWTpn4nCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIGJ1dHRvbjogX3dpdGhDdHgoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBbX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfdmFuX2J1dHRvbiwgewogICAgICAgICAgICAgICAgc2l6ZTogInNtYWxsIiwKICAgICAgICAgICAgICAgIHR5cGU6IF9jdHguZW5hYmxlID8gJ3ByaW1hcnknIDogJycsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiAkc2V0dXAuc2VuZGNvZGUsCiAgICAgICAgICAgICAgICBjbGFzczogImZvcm0tYnRuIiwKICAgICAgICAgICAgICAgIGRpc2FibGVkOiAhX2N0eC5lbmFibGUKICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiBfd2l0aEN0eChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBbX2NyZWF0ZVRleHRWTm9kZShfdG9EaXNwbGF5U3RyaW5nKF9jdHguZW5hYmxlID8gIuWPkemAgemqjOivgeeggSIgOiBfY3R4LnRpbWUpLCAxCiAgICAgICAgICAgICAgICAgIC8qIFRFWFQgKi8KICAgICAgICAgICAgICAgICAgKV07CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIF86IDEKICAgICAgICAgICAgICAgIC8qIFNUQUJMRSAqLwoKICAgICAgICAgICAgICB9LCA4CiAgICAgICAgICAgICAgLyogUFJPUFMgKi8KICAgICAgICAgICAgICAsIFsidHlwZSIsICJvbkNsaWNrIiwgImRpc2FibGVkIl0pXTsKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIF86IDEKICAgICAgICAgICAgLyogU1RBQkxFICovCgogICAgICAgICAgfSwgOAogICAgICAgICAgLyogUFJPUFMgKi8KICAgICAgICAgICwgWyJtb2RlbFZhbHVlIiwgInJ1bGVzIl0pLCBfY3JlYXRlQ29tbWVudFZOb2RlKCIg6aqM6K+B56CBICIpLCBfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF92YW5fZmllbGQsIHsKICAgICAgICAgICAgbW9kZWxWYWx1ZTogX2N0eC5jb2RlLAogICAgICAgICAgICAib25VcGRhdGU6bW9kZWxWYWx1ZSI6IF9jYWNoZVsxXSB8fCAoX2NhY2hlWzFdID0gZnVuY3Rpb24gKCRldmVudCkgewogICAgICAgICAgICAgIHJldHVybiBfY3R4LmNvZGUgPSAkZXZlbnQ7CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBsYWJlbDogIumqjOivgeeggSIsCiAgICAgICAgICAgICJsYWJlbC13aWR0aCI6ICI1MHB4IiwKICAgICAgICAgICAgcnVsZXM6IFt7CiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+mqjOivgeeggeS4uuW/heWhq+mhuScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIHBhdHRlcm46ICRzZXR1cC5yZWdDb2RlLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICfpqozor4HnoIHlv4XpobvmmK/lha3kvY3mlbDlrZflk6YnCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9LCBudWxsLCA4CiAgICAgICAgICAvKiBQUk9QUyAqLwogICAgICAgICAgLCBbIm1vZGVsVmFsdWUiLCAicnVsZXMiXSldOwogICAgICAgIH0pLAogICAgICAgIF86IDEKICAgICAgICAvKiBTVEFCTEUgKi8KCiAgICAgIH0pLCBfY3JlYXRlQ29tbWVudFZOb2RlKCIg55m75b2VL+azqOWGjOaMiemSriAiKSwgX2NyZWF0ZUVsZW1lbnRWTm9kZSgiZGl2IiwgX2hvaXN0ZWRfMSwgW19jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9idXR0b24sIHsKICAgICAgICByb3VuZDogIiIsCiAgICAgICAgYmxvY2s6ICIiLAogICAgICAgIHR5cGU6ICJwcmltYXJ5IiwKICAgICAgICAibmF0aXZlLXR5cGUiOiAic3VibWl0IgogICAgICB9LCB7CiAgICAgICAgZGVmYXVsdDogX3dpdGhDdHgoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFtfaG9pc3RlZF8yXTsKICAgICAgICB9KSwKICAgICAgICBfOiAxCiAgICAgICAgLyogU1RBQkxFICovCgogICAgICB9KV0pXTsKICAgIH0pLAogICAgXzogMQogICAgLyogU1RBQkxFICovCgogIH0sIDgKICAvKiBQUk9QUyAqLwogICwgWyJvblN1Ym1pdCJdKV0sIDY0CiAgLyogU1RBQkxFX0ZSQUdNRU5UICovCiAgKTsKfQ=="},{"version":3,"sources":["C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Login.vue"],"names":[],"mappings":";;;;;;;AAyCS,EAAA,KAAyB,EAAzB;AAAA,cAAA;AAAA;;;+CACyD,W;;;;;;;;;;;;;6DAzChE,YAAA,CAAO,cAAP,C,EACA,YAAA,CA4CW,mBA5CX,EA4CW;AA5CD,IAAA,GAAG,EAAC,SA4CH;AA5Cc,IAAA,QAAM,EAAE,MAAA,CAAA;AA4CtB,GA5CX,E;sBACE;AAAA,aAmCiB,CAnCjB,YAAA,CAmCiB,yBAnCjB,EAmCiB;AAnCD,QAAA,KAAK,EAAL;AAmCC,OAnCjB,EAAqB;0BACnB;AAAA,iBAAY,CAAZ,mBAAA,CAAA,OAAA,CAAY,EACZ,YAAA,CAsBY,oBAtBZ,EAsBY;wBArBD,IAAA,CAAA,KAqBC;;qBArBD,IAAA,CAAA,K,GAAK,M;cAqBJ;AApBV,YAAA,MAAM,EAAN,EAoBU;AAnBV,YAAA,KAAK,EAAC,KAmBI;AAlBV,2BAAY,MAkBF;AAjBV,YAAA,IAAI,EAAC,OAiBK;AAhBT,YAAA,KAAK,EAAA,C;;;aAAA,E;uBAA6E,MAAA,CAAA,Q;AAAQ,cAAA,OAAA,EAAA;aAArF;AAgBI,WAtBZ,E;AAWa,YAAA,MAAM,EAAA,QAAA,CACf;AAAA,qBAQa,CARb,YAAA,CAQa,qBARb,EAQa;AAPX,gBAAA,IAAI,EAAC,OAOM;AANV,gBAAA,IAAI,EAAE,IAAA,CAAA,MAAA,GAAM,SAAN,GAAM,EAMF;AALV,gBAAA,OAAK,EAAE,MAAA,CAAA,QAKG;AAJX,gBAAA,KAAK,EAAC,UAIK;AAHV,gBAAA,QAAQ,EAAA,CAAG,IAAA,CAAA;AAGD,eARb,E;kCAOE;AAAA,yBAA6B,C,kCAA1B,IAAA,CAAA,MAAA,GAAM,OAAN,GAAmB,IAAA,CAAA,I,GAAI;AAAA;mBAAG,CAA7B;AAAA,iB;;;;eAPF,E;;AAAA,gB,+BAAA,CAQa,CARb;AAAA,aADe,C;;;;WAXnB,E;;AAAA,Y,uBAAA,CADY,EAwBZ,mBAAA,CAAA,OAAA,CAxBY,EAyBZ,YAAA,CAQE,oBARF,EAQE;wBAPS,IAAA,CAAA,IAOT;;qBAPS,IAAA,CAAA,I,GAAI,M;cAOb;AANA,YAAA,KAAK,EAAC,KAMN;AALA,2BAAY,MAKZ;AAJC,YAAA,KAAK,EAAA,C;;;aAAA,E;uBAA6E,MAAA,CAAA,O;AAAO,cAAA,OAAA,EAAA;aAApF;AAIN,WARF,E,IAAA,E;;AAAA,Y,uBAAA,CAzBY,CAAZ;AAAA,S,CADmB;;;;AAAA,OAArB,CAmCiB,EAEjB,mBAAA,CAAA,WAAA,CAFiB,EAGjB,mBAAA,CAIM,KAJN,EAAA,UAAA,EAIM,CAHJ,YAAA,CAEa,qBAFb,EAEa;AAFD,QAAA,KAAK,EAAL,EAEC;AAFK,QAAA,KAAK,EAAL,EAEL;AAFW,QAAA,IAAI,EAAC,SAEhB;AAF0B,uBAAY;AAEtC,OAFb,E;0BAA4D;AAAA,iBAE5D,C,UAAA,CAF4D;AAAA,S;;;;OAA5D,CAGI,CAJN,CAHiB,CAnCjB;AAAA,K;;;;GADF,E;;AAAA,I,YAAA,C","sourcesContent":["<template>\r\n  <Nav />\r\n  <van-form ref=\"formBox\" @submit=\"submit\">\r\n    <van-cell-group inset>\r\n      <!-- 手机号 -->\r\n      <van-field\r\n        v-model=\"phone\"\r\n        center\r\n        label=\"手机号\"\r\n        label-width=\"50px\"\r\n        name=\"phone\"\r\n        :rules=\"[\r\n          { required: true, message: '手机号为必填项' },\r\n          { pattern: regPhone, message: '手机号格式不对哦~' },\r\n        ]\"\r\n      >\r\n        <template #button>\r\n          <van-button\r\n            size=\"small\"\r\n            :type=\"enable ? 'primary' : ''\"\r\n            @click=\"sendcode\"\r\n            class=\"form-btn\"\r\n            :disabled=\"!enable\"\r\n          >\r\n            {{ enable ? \"发送验证码\" : time }}\r\n          </van-button>\r\n        </template>\r\n      </van-field>\r\n      <!-- 验证码 -->\r\n      <van-field\r\n        v-model=\"code\"\r\n        label=\"验证码\"\r\n        label-width=\"50px\"\r\n        :rules=\"[\r\n          { required: true, message: '验证码为必填项' },\r\n          { pattern: regCode, message: '验证码必须是六位数字哦' },\r\n        ]\"\r\n      />\r\n    </van-cell-group>\r\n\r\n    <!-- 登录/注册按钮 -->\r\n    <div style=\"margin: 20px 40px\">\r\n      <van-button round block type=\"primary\" native-type=\"submit\">\r\n        立即登录/注册\r\n      </van-button>\r\n    </div>\r\n  </van-form>\r\n</template>\r\n\r\n<script>\r\nimport Nav from \"@/components/Nav.vue\";\r\nimport { reactive, toRefs, ref } from \"vue\";\r\nimport api from \"../api/index\";\r\nimport { Toast } from \"vant\";\r\nimport { useStore} from 'vuex';\r\nimport{useRouter, useRoute} from 'vue-router'\r\nexport default {\r\n  components: { Nav },\r\n  name: \"Login\",\r\n  setup() {\r\n    const store = useStore(),\r\n     router = useRouter(),\r\n     route = useRoute();\r\n\r\n    let state = reactive({\r\n      phone: \"\",\r\n      code: \"\",\r\n      enable: true,\r\n      time: \"60s\",\r\n    });\r\n    let formBox = ref(null);\r\n    // 发送验证码\r\n    const sendcode = async () => {\r\n      try {\r\n        // 校验手机号\r\n        await formBox.value.validate(\"phone\");\r\n        // 发送请求\r\n        let { code } = await api.phoneCode(state.phone);\r\n        if (+code !== 0) {\r\n          Toast(\"当前网络繁忙，请稍后再试！\");\r\n          return;\r\n        }\r\n        // 开启倒计时\r\n        state.enable = false;\r\n        state.time = `10s`;\r\n        let n = 10;\r\n        let timer = setInterval(() => {\r\n          n--;\r\n          if (n === 0) {\r\n            clearInterval(timer);\r\n            state.enable = true;\r\n            return;\r\n          }\r\n          state.time = `${n}s`;\r\n        }, 1000);\r\n      } catch (error) {}\r\n    };\r\n    // 表单提交\r\n    const submit = async () => {\r\n      // 登录\r\n      let { code, token } = await api.login(state.phone, state.code);\r\n      // 通过code，验证是否登录成功\r\n      if(+code !== 0) {\r\n        Toast('小主很遗憾，当前登录失败了!');\r\n        formBox.value.resetValidation();\r\n        state.code = '';\r\n        return;\r\n      }\r\n      // 存储token信息\r\n      localStorage.setItem('token', token);\r\n      // 存储是否登录的状态\r\n      store.commit('changeIsLogin', true);\r\n      // 存储获取到的登录的信息\r\n      store.dispatch('changeAsyncInfo')\r\n      // 清除vuex中已有的storelist的信息\r\n      store.commit('changeStoreList', null);\r\n      Toast('小主真棒，当前登录成功了!');\r\n      let from = route.query.from;\r\n      // route中如果有from跳转到from，没有from跳转到个人中心\r\n      if(from) {\r\n        router.replace(`/${from}`);\r\n        return;\r\n      }\r\n      router.replace(`/person`);\r\n    };\r\n\r\n    return {\r\n      ...toRefs(state),\r\n      formBox,\r\n      regPhone: /^1\\d{10}/,\r\n      regCode: /\\d{6}/,\r\n      sendcode,\r\n      submit,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.van-form {\r\n  margin-top: 30px;\r\n\r\n  .form-btn {\r\n    width: 78px;\r\n  }\r\n}\r\n</style>\r\n"],"sourceRoot":""}]}