{"remainingRequest":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Detail.vue?vue&type=template&id=74779916&scoped=true","dependencies":[{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Detail.vue","mtime":1658239034678},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\babel.config.js","mtime":1658239012002},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\babel-loader\\lib\\index.js","mtime":1658554870645},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1658554972315},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1658554939499},{"path":"C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1658554910597}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgcmVzb2x2ZUNvbXBvbmVudCBhcyBfcmVzb2x2ZUNvbXBvbmVudCwgb3BlbkJsb2NrIGFzIF9vcGVuQmxvY2ssIGNyZWF0ZUJsb2NrIGFzIF9jcmVhdGVCbG9jaywgY3JlYXRlQ29tbWVudFZOb2RlIGFzIF9jcmVhdGVDb21tZW50Vk5vZGUsIGNyZWF0ZUVsZW1lbnRCbG9jayBhcyBfY3JlYXRlRWxlbWVudEJsb2NrLCBjcmVhdGVWTm9kZSBhcyBfY3JlYXRlVk5vZGUsIGNyZWF0ZUVsZW1lbnRWTm9kZSBhcyBfY3JlYXRlRWxlbWVudFZOb2RlLCBGcmFnbWVudCBhcyBfRnJhZ21lbnQsIHB1c2hTY29wZUlkIGFzIF9wdXNoU2NvcGVJZCwgcG9wU2NvcGVJZCBhcyBfcG9wU2NvcGVJZCB9IGZyb20gInZ1ZSI7Cgp2YXIgX3dpdGhTY29wZUlkID0gZnVuY3Rpb24gX3dpdGhTY29wZUlkKG4pIHsKICByZXR1cm4gX3B1c2hTY29wZUlkKCJkYXRhLXYtNzQ3Nzk5MTYiKSwgbiA9IG4oKSwgX3BvcFNjb3BlSWQoKSwgbjsKfTsKCnZhciBfaG9pc3RlZF8xID0gWyJpbm5lckhUTUwiXTsKdmFyIF9ob2lzdGVkXzIgPSB7CiAgY2xhc3M6ICJuYXYtYm94Igp9OwpleHBvcnQgZnVuY3Rpb24gcmVuZGVyKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIHZhciBfY29tcG9uZW50X3Zhbl9za2VsZXRvbiA9IF9yZXNvbHZlQ29tcG9uZW50KCJ2YW4tc2tlbGV0b24iKTsKCiAgdmFyIF9jb21wb25lbnRfdmFuX2ljb24gPSBfcmVzb2x2ZUNvbXBvbmVudCgidmFuLWljb24iKTsKCiAgcmV0dXJuIF9vcGVuQmxvY2soKSwgX2NyZWF0ZUVsZW1lbnRCbG9jayhfRnJhZ21lbnQsIG51bGwsIFtfY3R4Lm5ld3NJbmZvID09PSBudWxsID8gKF9vcGVuQmxvY2soKSwgX2NyZWF0ZUJsb2NrKF9jb21wb25lbnRfdmFuX3NrZWxldG9uLCB7CiAgICBrZXk6IDAsCiAgICB0aXRsZTogIiIsCiAgICByb3c6IDUKICB9KSkgOiAoX29wZW5CbG9jaygpLCBfY3JlYXRlRWxlbWVudEJsb2NrKCJkaXYiLCB7CiAgICBrZXk6IDEsCiAgICBjbGFzczogImNvbnRlbnQiLAogICAgaW5uZXJIVE1MOiBfY3R4Lm5ld3NJbmZvLmJvZHkKICB9LCBudWxsLCA4CiAgLyogUFJPUFMgKi8KICAsIF9ob2lzdGVkXzEpKSwgX2NyZWF0ZUVsZW1lbnRWTm9kZSgiZGl2IiwgX2hvaXN0ZWRfMiwgW19jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9pY29uLCB7CiAgICBuYW1lOiAiYXJyb3ctbGVmdCIsCiAgICBvbkNsaWNrOiAkc2V0dXAuaGFuZGxlCiAgfSwgbnVsbCwgOAogIC8qIFBST1BTICovCiAgLCBbIm9uQ2xpY2siXSksIF9jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9pY29uLCB7CiAgICBuYW1lOiAiY29tbWVudC1vIiwKICAgIGJhZGdlOiBfY3R4LmNvbW1lbnRzCiAgfSwgbnVsbCwgOAogIC8qIFBST1BTICovCiAgLCBbImJhZGdlIl0pLCBfY3JlYXRlVk5vZGUoX2NvbXBvbmVudF92YW5faWNvbiwgewogICAgbmFtZTogImdvb2Qtam9iLW8iLAogICAgYmFkZ2U6IF9jdHgucG9wdWxhcml0eQogIH0sIG51bGwsIDgKICAvKiBQUk9QUyAqLwogICwgWyJiYWRnZSJdKSwgX2NyZWF0ZVZOb2RlKF9jb21wb25lbnRfdmFuX2ljb24sIHsKICAgIG5hbWU6ICJzdGFyLW8iLAogICAgY29sb3I6ICRzZXR1cC5pc1N0b3JlID8gJyMxOTg5ZmEnIDogJyMwMDAnLAogICAgb25DbGljazogJHNldHVwLnN0b3JlSGFuZGxlCiAgfSwgbnVsbCwgOAogIC8qIFBST1BTICovCiAgLCBbImNvbG9yIiwgIm9uQ2xpY2siXSksIF9jcmVhdGVWTm9kZShfY29tcG9uZW50X3Zhbl9pY29uLCB7CiAgICBuYW1lOiAic2hhcmUtbyIsCiAgICBjb2xvcjogIiNjY2MiCiAgfSldKV0sIDY0CiAgLyogU1RBQkxFX0ZSQUdNRU5UICovCiAgKTsKfQ=="},{"version":3,"sources":["C:\\Users\\James\\Desktop\\kejian\\vue3知乎日报\\zhihu\\src\\pages\\Detail.vue"],"names":[],"mappings":";;;;;;;;AAGO,EAAA,KAAK,EAAC;;;;;;;6DAFwB,IAAA,CAAA,QAAA,KAAQ,I,kBAA3C,YAAA,CAAwD,uBAAxD,EAAwD;UAAA;AAA1C,IAAA,KAAK,EAAL,EAA0C;AAAnC,IAAA,GAAG,EAAE;AAA8B,GAAxD,C,mBACA,mBAAA,CAAyD,KAAzD,EAAyD;UAAA;AAApD,IAAA,KAAK,EAAC,SAA8C;AAA7B,IAAA,SAAsB,EAAd,IAAA,CAAA,QAAA,CAAS;AAAY,GAAzD,E,IAAA,E;;AAAA,I,UAAA,C,GACA,mBAAA,CAUM,KAVN,EAAA,UAAA,EAUM,CATJ,YAAA,CAAuD,mBAAvD,EAAuD;AAA7C,IAAA,IAAI,EAAC,YAAwC;AAA1B,IAAA,OAAK,EAAE,MAAA,CAAA;AAAmB,GAAvD,E,IAAA,E;;AAAA,I,WAAA,CASI,EARJ,YAAA,CAAwD,mBAAxD,EAAwD;AAA9C,IAAA,IAAI,EAAC,WAAyC;AAA5B,IAAA,KAAK,EAAE,IAAA,CAAA;AAAqB,GAAxD,E,IAAA,E;;AAAA,I,SAAA,CAQI,EAPJ,YAAA,CAA2D,mBAA3D,EAA2D;AAAjD,IAAA,IAAI,EAAC,YAA4C;AAA9B,IAAA,KAAK,EAAE,IAAA,CAAA;AAAuB,GAA3D,E,IAAA,E;;AAAA,I,SAAA,CAOI,EANJ,YAAA,CAIY,mBAJZ,EAIY;AAHV,IAAA,IAAI,EAAC,QAGK;AAFT,IAAA,KAAK,EAAE,MAAA,CAAA,OAAA,GAAO,SAAP,GAAO,MAEL;AADT,IAAA,OAAK,EAAE,MAAA,CAAA;AACE,GAJZ,E,IAAA,E;;AAAA,I,oBAAA,CAMI,EADJ,YAAA,CAAiD,mBAAjD,EAAiD;AAAvC,IAAA,IAAI,EAAC,SAAkC;AAAxB,IAAA,KAAK,EAAC;AAAkB,GAAjD,CACI,CAVN,C","sourcesContent":["<template>\n  <van-skeleton title :row=\"5\" v-if=\"newsInfo === null\" />\n  <div class=\"content\" v-else v-html=\"newsInfo.body\"></div>\n  <div class=\"nav-box\">\n    <van-icon name=\"arrow-left\" @click=\"handle\"></van-icon>\n    <van-icon name=\"comment-o\" :badge=\"comments\"></van-icon>\n    <van-icon name=\"good-job-o\" :badge=\"popularity\"></van-icon>\n    <van-icon\n      name=\"star-o\"\n      :color=\"isStore ? '#1989fa' : '#000'\"\n      @click=\"storeHandle\"\n    ></van-icon>\n    <van-icon name=\"share-o\" color=\"#ccc\"></van-icon>\n  </div>\n</template>\n\n<script>\nimport { useRouter, useRoute } from \"vue-router\";\nimport {\n  reactive,\n  toRefs,\n  onBeforeMount,\n  onBeforeUnmount,\n  onUpdated,\n  computed,\n} from \"vue\";\nimport api from \"@/api/index\";\nimport { useStore } from \"vuex\";\nimport { Toast } from \"vant\";\n\nexport default {\n  name: \"Detail\",\n  setup() {\n    const router = useRouter(),\n      route = useRoute(),\n      store = useStore();\n    let state = reactive({\n      comments: 0,\n      popularity: 0,\n      newsInfo: null,\n    });\n\n    let isStore = computed(() => {\n      let { isLogin, storeList } = store.state;\n      if (isLogin) {\n        if (!Array.isArray(storeList)) storeList = [];\n        return storeList.some((item) => {\n          return +item.news.id === +route.params.id;\n        });\n      }\n      return false;\n    });\n    onBeforeMount(async () => {\n      if (store.state.isLogin === null) {\n        await store.dispatch(\"changeIsLoginAsync\");\n      }\n      if (store.state.isLogin) {\n        if (store.state.info === null) store.dispatch(\"changeInfoAsync\");\n        if (store.state.storeList === null)\n          store.dispatch(\"changeStoreListAsync\");\n      }\n    });\n    const storeHandle = async () => {\n      if (!store.state.isLogin) {\n        Toast(\"小主，请先登录哦~\");\n        router.push({\n          path: \"/login\",\n          query: {\n            from: `detail/${route.params.id}`,\n          },\n        });\n        return;\n      }\n      if (isStore.value) return;\n      let { code } = await api.store(route.params.id);\n      if (+code !== 0) {\n        Toast(\"小主，很遗憾，收藏失败~\");\n        return;\n      }\n      Toast(\"小主很棒，收藏成功了~\");\n      store.dispatch(\"changeStoreListAsync\");\n    };\n\n    onBeforeMount(async () => {\n      let id = route.params.id;\n      let result = await api.queryNewsInfo(id);\n      state.newsInfo = result;\n      // 动态创建CSS\n      let link = document.createElement(\"link\");\n      link.id = \"link\";\n      link.rel = \"stylesheet\";\n      link.href = state.newsInfo.css[0];\n      document.head.appendChild(link);\n      let { popularity, comments } = await api.queryNewsStory(id);\n      state.popularity = popularity;\n      state.comments = comments;\n    });\n    onUpdated(() => {\n      let imgPlaceHolder = document.querySelector(\".img-place-holder\");\n      if (imgPlaceHolder) {\n        if (imgPlaceHolder.innerHTML.trim() === \"\") {\n          imgPlaceHolder.innerHTML += `<img src=\"${state.newsInfo.image}\" alt=\"\"/>`;\n        }\n      }\n    });\n    onBeforeUnmount(() => {\n      let link = document.getElementById(\"link\");\n      if (!link) return;\n      document.head.removeChild(link);\n    });\n\n    const handle = () => {\n      router.back();\n    };\n\n    return {\n      ...toRefs(state),\n      isStore,\n      handle,\n      storeHandle,\n    };\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.content {\n  background: #fff;\n  padding-bottom: 50px;\n  margin: 0;\n\n  /deep/ .img-place-holder {\n    height: 375px;\n    overflow: hidden;\n    img {\n      display: block;\n      margin: 0;\n      width: 100%;\n      min-height: 100%;\n    }\n  }\n}\n\n.van-skeleton {\n  padding: 30px 15px;\n}\n\n.nav-box {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  box-sizing: border-box;\n  padding: 0 15px;\n  width: 100%;\n  height: 50px;\n  background: #f4f4f4;\n\n  .van-icon:nth-child(1) {\n    position: relative;\n    &::after {\n      position: absolute;\n      top: -10%;\n      right: -15px;\n      content: \"\";\n      width: 1px;\n      height: 120%;\n      background: #d5d5d5;\n    }\n  }\n\n  /deep/ .van-badge {\n    background-color: transparent;\n    border: none;\n    color: #000;\n    right: -5px;\n  }\n}\n</style>"],"sourceRoot":""}]}